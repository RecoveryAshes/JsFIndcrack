# 配置文件使用说明

## 概述

JsFIndcrack 现在支持通过配置文件自定义各种参数，包括请求头(headers)、代理设置、cookies等。首次运行程序时会自动在当前目录下创建 `config` 目录，并生成默认配置文件。

## 配置文件结构

```
config/
├── config.json           # 主配置文件
└── custom_headers.json   # 自定义headers集合
```

## 主配置文件 (config.json)

### 1. 自定义请求头 (headers)

在 `config.json` 中的 `headers` 部分添加或修改请求头：

```json
{
    "headers": {
        "User-Agent": "自定义User-Agent",
        "Accept": "text/html,application/xhtml+xml,application/xml",
        "Accept-Language": "zh-CN,zh;q=0.9",
        "Authorization": "Bearer your-token-here",
        "X-Custom-Header": "custom-value"
    }
}
```

常用请求头示例：
- `Authorization`: 用于API认证
- `Cookie`: 设置cookie（也可以使用cookies配置）
- `Referer`: 设置来源页面
- `X-Requested-With`: 标识AJAX请求

### 2. 爬虫配置 (crawler)

```json
{
    "crawler": {
        "timeout": 30,              // 请求超时时间(秒)
        "max_retries": 3,           // 最大重试次数
        "delay_between_requests": 1, // 请求间隔(秒)
        "verify_ssl": false,        // 是否验证SSL证书
        "max_file_size_mb": 50      // 最大文件大小(MB)
    }
}
```

### 3. 浏览器配置 (browser)

```json
{
    "browser": {
        "engine": "playwright",      // 浏览器引擎: "selenium" 或 "playwright"
        "headless": true,            // 是否无头模式
        "page_load_timeout": 60,     // 页面加载超时(秒)
        "window_size": "1920,1080",  // 窗口大小
        "playwright_browser": "chromium" // Playwright浏览器类型
    }
}
```

### 4. 代理配置 (proxy)

```json
{
    "proxy": {
        "enabled": true,                    // 启用代理
        "http": "http://127.0.0.1:7890",   // HTTP代理
        "https": "http://127.0.0.1:7890",  // HTTPS代理
        "no_proxy": "localhost,127.0.0.1"   // 不使用代理的地址
    }
}
```

### 5. Cookies配置

```json
{
    "cookies": [
        {
            "name": "session_id",
            "value": "abc123xyz",
            "domain": ".example.com",
            "path": "/",
            "secure": true,
            "httpOnly": true
        }
    ]
}
```

## 自定义Headers集合 (custom_headers.json)

支持定义多套headers配置，方便在不同场景切换：

```json
{
    "headers_sets": {
        "default": {
            "description": "默认请求头",
            "headers": {
                "User-Agent": "Mozilla/5.0..."
            }
        },
        "mobile": {
            "description": "移动端请求头",
            "headers": {
                "User-Agent": "Mozilla/5.0 (iPhone...)"
            }
        },
        "api": {
            "description": "API请求头",
            "headers": {
                "Content-Type": "application/json",
                "Authorization": "Bearer token"
            }
        }
    },
    "active_set": "default"  // 当前使用的headers集合
}
```

切换headers集合：修改 `active_set` 字段为对应的集合名称。

## 使用示例

### 示例1：添加认证Token

编辑 `config/config.json`：

```json
{
    "headers": {
        "Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
        "X-API-Key": "your-api-key"
    }
}
```

### 示例2：配置代理

```json
{
    "proxy": {
        "enabled": true,
        "http": "socks5://127.0.0.1:1080",
        "https": "socks5://127.0.0.1:1080"
    }
}
```

### 示例3：添加Cookies

```json
{
    "cookies": [
        {
            "name": "auth_token",
            "value": "xxx123",
            "domain": ".target.com"
        },
        {
            "name": "session",
            "value": "yyy456",
            "domain": ".target.com"
        }
    ]
}
```

### 示例4：使用移动端User-Agent

修改 `custom_headers.json` 的 `active_set`：

```json
{
    "active_set": "mobile"
}
```

## 注意事项

1. **配置文件优先级**：配置文件中的设置会覆盖程序默认值
2. **JSON格式**：确保配置文件是有效的JSON格式，否则会使用默认配置
3. **敏感信息**：不要将包含敏感信息（如token、密码）的配置文件提交到版本控制系统
4. **备份配置**：建议备份自定义的配置文件

## 配置验证

使用测试脚本验证配置是否生效：

```bash
python3 test_config.py
```

## 常见问题

### Q: 配置文件没有生效？
A: 检查JSON格式是否正确，可以使用在线JSON验证工具检查。

### Q: 如何恢复默认配置？
A: 删除 `config` 目录，程序会在下次运行时重新创建默认配置。

### Q: 可以使用环境变量覆盖配置吗？
A: 目前不支持，但可以通过修改配置文件实现。

## 高级用法

### 编程方式修改配置

```python
from src.core.config_manager import get_config_manager

# 获取配置管理器
config = get_config_manager()

# 添加自定义header
config.add_header("X-Custom", "value")

# 更新多个headers
config.update_headers({
    "Authorization": "Bearer token",
    "X-API-Version": "v1"
})

# 保存配置
config.save_config()
```
# JsFIndcrack 项目宪章

<!--
同步影响报告:
- 版本变更: 初始版本 → 1.0.0
- 新增原则: 13个核心开发规范
- 新增章节: 语言与文档规范、核心设计原则、代码结构与组织、版本控制流程、代码质量与风格、
  错误处理规范、日志规范、测试规范、安全性要求、API设计规范、性能优化指导、文档与任务管理、代码审查流程
- 模板更新状态:
  ✅ plan-template.md - 已验证与宪章一致
  ✅ spec-template.md - 已验证与宪章一致
  ✅ tasks-template.md - 已验证与宪章一致
- 待办事项: 无
-->

## 核心原则

### I. 语言与文档规范（不可协商）

所有代码注释（包括函数注释、代码说明、TODO等）必须使用中文，确保团队成员和AI助手能够准确理解。所有Markdown文档必须使用中文命名和中文内容（README.md除外），包括设计文档、API文档、任务文档等。文档和代码中禁止出现任何emoji表情符号，保持专业性和简洁性。

变量、函数、包名等遵循Go语言标准命名规范（英文），但必须配备中文注释说明其用途。

**理由**: 确保团队协作效率，降低沟通成本，提高代码可维护性。中文注释能让AI助手更准确理解意图，禁止emoji保持代码库专业性。

### II. 领域驱动设计（DDD）原则（不可协商）

必须遵循领域驱动设计思想，通过清晰的领域划分和接口抽象实现模块间的解耦。提倡使用小接口、组合优于继承，并严格遵守依赖倒置原则（DIP），确保高层模块不依赖低层模块的具体实现。

遵循SOLID原则，确保代码的可维护性、可测试性和可扩展性。接口设计应遵循最小知识原则，只暴露必要的方法和属性。

**理由**: DDD和SOLID原则是构建可维护、可扩展系统的基石。依赖倒置使系统更灵活，便于测试和替换实现。

### III. 工程化代码结构

项目应采用标准的工程化目录结构（`cmd/`, `internal/`, `pkg/`, `api/`, `configs/`, `docs/`等）。按业务领域（如`user/`, `order/`）而非技术层次（如`controller/`, `service/`）进行包的划分。

使用`internal`目录保护私有代码，防止外部模块非法导入。每个领域模块应包含清晰的分层：`domain`（领域模型）、`repository`（仓储接口）、`service`（应用服务）、`interface`（对外接口）。

**理由**: 标准化的目录结构提高代码可读性和可维护性。按领域划分使业务逻辑更清晰，便于团队协作和代码复用。

### IV. 版本控制流程（不可协商）

所有代码修改，无论大小，必须及时提交到本地Git版本控制系统。提交信息遵循约定式提交（Conventional Commits）规范：
- `feat: 添加用户注册功能`
- `fix: 修复订单金额计算错误`
- `refactor: 重构支付模块接口设计`
- `docs: 更新API文档`
- `test: 添加用户服务单元测试`

分支策略：
- `main/master`: 生产环境分支，只接受经过测试的合并
- `develop`: 开发分支，日常开发的主分支
- `feature/*`: 功能分支，开发新功能时从develop分支创建
- `hotfix/*`: 紧急修复分支，从main分支创建

在完成重要的完整功能后，建议手动将本地仓库推送到远程云仓库，以防止数据丢失。使用`git stash`保存未完成的工作，切换分支时保持工作区清洁。

**理由**: 规范的版本控制确保代码历史可追溯，便于团队协作和问题回溯。频繁提交降低代码丢失风险。

### V. 代码质量与风格

严格遵守Go语言官方的代码风格和最佳实践，使用`gofmt`或`goimports`统一格式。接口命名倾向于单一方法的动词形式（如`Reader`, `Writer`），并优先考虑最小化接口设计。

使用Go Modules进行依赖管理，定期执行`go mod tidy`清理无用依赖。代码注释率应达到至少30%，确保关键逻辑和复杂部分都有详细的中文注释。注释应简洁明了，重点解释"为什么"（设计意图）而不是"是什么"或"怎么做"（显而易见的逻辑）。

使用`golangci-lint`等工具定期检查代码质量，并在CI/CD流程中集成。

**理由**: 统一的代码风格提高可读性，降低维护成本。充分的注释帮助理解设计意图，便于后续维护和优化。

### VI. 错误处理规范

所有错误必须显式处理，不允许忽略错误返回值（除非有充分理由并添加注释说明）。使用`errors.Wrap`或`fmt.Errorf`的`%w`格式化动词包装错误，保留错误链。

自定义错误类型应包含足够的上下文信息，便于排查问题。业务错误和系统错误应明确区分，使用不同的错误码体系。

**理由**: 显式错误处理避免隐藏问题，错误链保留完整的调用栈信息，便于定位和修复问题。

### VII. 结构化日志规范

使用结构化日志库（如`zap`, `logrus`），避免使用`fmt.Println`输出日志。日志级别使用规范：
- `Debug`: 开发调试信息
- `Info`: 正常业务流程信息
- `Warn`: 潜在问题警告
- `Error`: 错误信息，需要关注但不影响系统运行
- `Fatal/Panic`: 严重错误，系统无法继续运行

日志内容应包含必要的上下文信息（如请求ID、用户ID、操作类型等）。敏感信息（密码、token、身份证号等）禁止输出到日志中。

**理由**: 结构化日志便于日志分析和问题排查。合理的日志级别帮助快速定位问题。敏感信息保护确保系统安全。

### VIII. 测试优先原则（不可协商）

编写高质量的单元测试，测试覆盖率应达到70%以上，核心业务逻辑应达到90%以上。利用接口的可替换性进行Mock测试，使用`gomock`或`testify/mock`等工具。

编写集成测试验证模块间的协作，使用`testcontainers`等工具管理测试依赖。对于性能敏感的部分，编写基准测试（Benchmark Tests）以优化代码性能。

测试文件命名为`*_test.go`，测试函数以`Test`开头，基准测试以`Benchmark`开头。测试用例应包含正常场景、边界条件和异常场景。

**理由**: 高测试覆盖率确保代码质量和可维护性。测试驱动开发减少bug，提高开发效率。

### IX. 安全性要求（不可协商）

所有外部输入必须进行校验和清洗，防止注入攻击（SQL注入、命令注入等）。敏感数据（密码、密钥等）必须加密存储，使用行业标准的加密算法。

API接口必须实施认证和授权机制，遵循最小权限原则。使用`context`包管理请求的生命周期，实现超时控制和优雅关闭。

定期更新依赖库，修复已知的安全漏洞，可使用`go list -m -u all`检查更新。

**理由**: 安全是系统的基础，必须从设计阶段就考虑安全性。多层防护确保系统健壮性。

### X. RESTful API设计规范

RESTful API应遵循标准的HTTP语义，合理使用GET、POST、PUT、DELETE等方法。API路径应清晰表达资源层级关系，如`/api/v1/users/{id}/orders`。

使用版本控制（如`/v1/`, `/v2/`）保证API的向后兼容性。统一的响应格式，包含`code`（状态码）、`message`（消息）、`data`（数据）等字段。

提供完整的API文档（使用Swagger/OpenAPI等工具），包含请求示例、响应示例和错误码说明。

**理由**: 标准化的API设计提高可读性和可维护性，版本控制确保向后兼容，完整文档降低接入成本。

### XI. 性能优化指导

避免在循环中进行不必要的内存分配，使用`sync.Pool`复用对象。合理使用并发，使用`goroutine`和`channel`处理异步任务，但避免过度并发导致资源浪费。

使用`context`实现请求超时和取消机制，避免goroutine泄漏。数据库查询应使用索引，避免全表扫描；使用连接池管理数据库连接。

对热点数据使用缓存（如Redis），设置合理的过期时间和淘汰策略。使用`pprof`进行性能分析，定位性能瓶颈。

**理由**: 性能优化应基于实际测量，避免过早优化。合理的并发和缓存策略提高系统吞吐量。

### XII. 文档与任务管理

及时更新任务文档，确保所有任务和进度都记录清晰，使用Markdown格式。重要的设计决策应记录在架构设计文档（ADR - Architecture Decision Record）中。

每个模块应有模块说明文档，描述其职责、接口和使用方式。复杂的业务流程应配备流程图或时序图，便于理解和维护。所有文档保存到合适的位置。

**理由**: 完善的文档是团队协作的基础，降低沟通成本，便于知识传承。

### XIII. 代码审查流程（不可协商）

所有代码合并到主分支前必须经过代码审查（Code Review）。审查重点：代码风格、设计合理性、错误处理、测试覆盖、性能问题、安全风险。

审查意见应具体明确，附带改进建议和相关文档链接。

**理由**: 代码审查是保证代码质量的重要环节，多人评审降低缺陷率，促进知识共享。

## 开发工作流程

### 功能开发流程

1. 从`develop`分支创建`feature/*`分支
2. 编写功能规格说明（spec.md），明确需求和验收标准
3. 编写实施计划（plan.md），设计技术方案
4. 编写单元测试，确保测试先行
5. 实现功能代码，确保通过所有测试
6. 更新相关文档（API文档、模块说明等）
7. 提交代码审查，修复审查问题
8. 合并到`develop`分支
9. 定期将`develop`合并到`main`进行发布

### 代码审查检查清单

- [ ] 代码风格符合Go官方规范
- [ ] 中文注释完整，注释率≥30%
- [ ] 所有错误已显式处理
- [ ] 单元测试覆盖率≥70%（核心业务≥90%）
- [ ] 集成测试覆盖关键流程
- [ ] API文档已更新
- [ ] 敏感信息已脱敏或加密
- [ ] 性能关键路径已优化
- [ ] 安全风险已评估
- [ ] 依赖库版本已检查

## 治理规则

本宪章优先于所有其他开发实践和规范。所有合并请求和代码审查必须验证符合宪章要求。任何违反核心原则（标记为"不可协商"）的代码不得合并到主分支。

复杂性必须有充分的理由和文档支持。当实施细节与宪章冲突时，应优先遵守宪章，并通过修正案流程更新宪章。

### 修正流程

宪章修正需要以下步骤：
1. 提出修正提案，说明修正原因和影响范围
2. 团队讨论和评审
3. 获得多数成员批准（至少2/3赞成）
4. 更新宪章版本号（遵循语义化版本规范）
5. 更新所有依赖模板（plan-template.md, spec-template.md, tasks-template.md等）
6. 通知所有团队成员并提供迁移指南

### 版本控制规范

版本号采用`MAJOR.MINOR.PATCH`格式：
- `MAJOR`: 向后不兼容的治理/原则移除或重新定义
- `MINOR`: 新增原则/章节或显著扩展指导
- `PATCH`: 澄清说明、措辞修改、非语义优化

### 合规审查

每季度进行一次宪章合规审查，评估：
- 现有代码库的合规程度
- 原则的适用性和有效性
- 是否需要修订或新增原则

审查结果应记录在`docs/compliance-reports/`目录下。

**版本**: 1.0.0 | **批准日期**: 2025-11-15 | **最后修订**: 2025-11-15
